<!-- Vue du contributeur -->
{% extends "base.html"%}
{% load static %}

{% block script%}

<script src="{% static "javascript/drag_drop.js" %}"></script>
<script src="{% static "javascript/send_post_ajax.js" %}"></script>


<script>

   $(document).ready(
      function() {
         {% if particular.type == "ADD" %}
            document.getElementById("newproject-nav_item").classList.add("active");
         {% else %}
            {% if project.public == "PU" %}
               document.getElementById("publicCheck").checked = true;
            {% endif %}
         {% endif %}

         initiate_drag();

         $("#form").submit(function(e){
            e.preventDefault();
            post_form("{% url "newproject" %}");
         });
      }
   )



</script>


{%endblock%}



{% block css %}
<style>
   a:hover {
   	text-decoration : none;
   	color : black;
   }

   .member_box:hover {
      background-color: rgba(0, 0, 0, 0.1);
   }

   .member_box {
      cursor: move;
      background-color: rgba(0, 0, 0, 0.05);
   }



</style>
{% endblock %}






{% block content %}



<div class="container">
   <div class="toast" id="toast_member" data-delay="3000" style="position: fixed; bottom: 1rem; right: 1rem; min-width:250px; z-index: 1000;" aria-live="assertive" aria-atomic="true">
      <div class="toast-header" style="background-color: #fc9d9d">
         <i class="fa fa-warning"></i>
         <strong class="mr-auto ml-2" style="color: #555555">Membres</strong>
         <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Fermer"><span aria-hidden="true">&times;</span></button>
      </div>
      <div class="toast-body">
         Veuillez ajouter au moins un membre
      </div>
   </div>
</div>


<!-- ================ TOAST Tache crée ================ -->
<div class="container">
   <div class="toast" id="toast_valid" data-delay="3000" style="position: fixed; bottom: 1rem; right: 1rem; min-width:250px;" aria-live="assertive" aria-atomic="true">
      <div class="toast-header" style="background-color: #c9c9c9">
         <i class="fa fa-edit"></i>
         {% if particular.type == "MODIFY" %}
            <strong class="mr-auto ml-2">Modification du projet</strong>
         {% else %}
            <strong class="mr-auto ml-2">Nouveau projet</strong>
         {% endif %}
         <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Fermer"><span aria-hidden="true">&times;</span></button>
      </div>
      <div class="toast-body" id="toast_body">

      </div>
   </div>
</div>


<div class="m-5">

   <!-- ================ Retour page précédente ================ -->
   {% if particular.type == "MODIFY" %}
      <a href="{% url "focus_project" id=project.id %}"><i class="fa fa-angle-double-left"></i> {{ project }}</a>
   {% endif %}


   <!-- ================ HEADER ================ -->
   <div class="mx-5 my-3">
      {% if particular.type == "MODIFY" %}
         <h2>Modification du projet <em>{{ project }}</em></h2>
      {% else %}
         <h2 class="border-bottom p-1">Créer un nouveau projet</h2>
      {% endif %}

      <br/>
   </div>

   {% for error in form.errors %}
   <p>{{ error }}</p>
   {% endfor %}


   <!-- ================ FORM ================ -->
   {% if particular.type == "MODIFY" %}
      <form action="{% url "manageproject" id=project.id %}" method="post" id="form">
   {% else %}
      <form action="{% url "newproject" %}" method="post" id="form">
   {% endif %}

      {% csrf_token %}

      <!-- ================ Champ nom ================ -->
      <div class="form-group row">
         <div class="col-md-2 col-form-label">
            Titre :
         </div>
         <div class="col-md-10">
            {{ form.name }}
         </div>
      </div>


      <!-- ================ Page membres ================ -->
		<!-- TODO Faire un truc plus style ici https://openclassrooms.com/fr/courses/1916641-dynamisez-vos-sites-web-avec-javascript/1922434-le-drag-drop -->
      <!-- https://www.w3schools.com/html/tryit.asp?filename=tryhtml5_draganddrop2 -->
      <!-- https://stackoverflow.com/questions/52797484/how-to-drag-dom-element-inside-canvas-without-going-out-of-canvas-with-p5js -->
		<div class="form-group row">
         <div class="col-md-2 col-form-label">
            Membres :
         </div>
         <div class="ml-3 col-md-2 border rounded place_user">
            <strong>Utilisateurs</strong>
            {% for member in members %}
               <div class="my-2 p-2 border member_box rounded" draggable="True">{{ member }}</div>
            {% endfor %}
         </div>

         <div class="ml-3 col-md-2 border rounded place_member">
            <strong>Membres du projet</strong><br/>
         </div>

      </div>




      <!-- ================ Projet public ou non ================ -->
      <div class="form-check">
         <input type="checkbox" name="publicCheck" class="form-check-input" id="publicCheck">
         <label class="form-check-label" for="publicCheck">Rendre mon projet public</label>
      </div>

		<br/>




      <!-- ================ BUTTONS ================ -->
      {% if particular.type == "MODIFY" %}
         <div class="row">
            <div class="col-6">
               <input type="submit" name="save" value="Enregistrer les modifications"/>
            </div>
            <div class="col-6 text-right">
               <input type="submit" name="delete" value="Supprimer le projet" class="btn btn-danger"/>
            </div>
         </div>
      {% else %}
         <input type="submit" value="Créer le projet" />
      {% endif %}

   </form>
</div>

{% endblock %}

<!-- Vue du contributeur -->
{% extends "base.html"%}
{% load static %}

{% block script%}
<script>
   $(document).ready(
      function() {
         {% if added or error_category %}
            $('.toast').toast('show');
         {% endif %}
      }
   )

   $(function () {
      $('#datetimepicker1').datetimepicker({
         locale: 'fr'
      });
      $('#datetimepicker2').datetimepicker({
         locale: 'fr'
      });
   });

   function toggle_visibility(id) {
      var e = document.getElementById(id);
         e.style.display = 'block';
   }

   function create_subtask() {
      var input = document.createElement("input");
      input.type = "text";
      input.name = "new_subtask";
      input.className = "form-control mb-2";
      input.maxlength = "200";
      input.placeholder = "Nouvelle sous-tâche";
      document.getElementById("subtasks").prepend(input);

   }


</script>


<!-- Datepicker -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/js/tempusdominus-bootstrap-4.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/css/tempusdominus-bootstrap-4.min.css" />

{%endblock%}

{% block css %}
<style>
a:hover {
	text-decoration : none;
	color : black;
}
</style>
{% endblock %}




{% block content %}


{% if added %}
<!-- TOAST Tache crée -->
   <div class="container">
      <div class="toast" data-delay="3000" style="position: fixed; bottom: 1rem; right: 1rem; min-width:250px; z-index:1000" aria-live="assertive" aria-atomic="true">
         <div class="toast-header" style="background-color: #c9c9c9">
            <i class="fa fa-plus"></i>
            <strong class="mr-auto ml-2">Nouvelle tâche</strong>
            <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Fermer"><span aria-hidden="true">&times;</span></button>
         </div>
         <div class="toast-body" >
            {{ new_task.name }} a bien été crée.
         </div>
      </div>
   </div>
{% endif %}

{% if error_category %}
<!-- TOAST Erreur -->
   <div class="container">
      <div class="toast" data-delay="3000" style="position: fixed; bottom: 1rem; right: 1rem; min-width:250px; z-index:1000" aria-live="assertive" aria-atomic="true">
         <div class="toast-header" style="background-color: #fc9d9d">
            <i class="fa fa-warning"></i>
            <strong class="mr-auto ml-2">Erreur lors de la création de la tâche</strong>
            <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Fermer"><span aria-hidden="true">&times;</span></button>
         </div>
         <div class="toast-body" >
            Il faut se décider sur la catégorie...
         </div>
      </div>
   </div>
{% endif %}



<div class="m-5">
   <a href="{% url "focus_project" id=project.id %}"><i class="fa fa-angle-double-left"></i> {{ project }}</a>

   <div class="mx-5 my-3">
      <h2 class="border-bottom p-1">Créer une nouvelle tâche</h2>
      <br />

   </div>


   {% for error in form.errors %}
   <p>
      {{ error }}
   </p>
   {% endfor %}

   <!-- =================================================================
      =========================== FORM ==================================
      =================================================================== -->
   <form action="{% url "newtask" id_project=project.id %}" method="post" enctype="multipart/form-data">
      {% csrf_token %}

      <div class="form-group row">
         <div class="col-md-2 col-form-label">
            Projet :
         </div>
         <div class="col-md-10">
            <input type="text" class="form-control" value='{{ project.name }}' readonly>
         </div>
      </div>

      {% for field in form %}

         <!-- ======= CHAMP DATES ========= -->
         {% if field.name == "start_date"%}
         <div class="form-group row">
            <div class="col-md-2 col-form-label">
               {{ field.label_tag }}
            </div>
            <div class="col-md-10">
               <div class="input-group date" id="datetimepicker1" data-target-input="nearest">
                  <input name="{{ field.name }}" type="text" class="form-control datetimepicker-input" data-target="#datetimepicker1" id="from" required/>
                  <div class="input-group-append" data-target="#datetimepicker1" data-toggle="datetimepicker">
                     <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                  </div>
               </div>
            </div>
         </div>


         {% elif field.name == "due_date"%}
         <div class="form-group row">
            <div class="col-md-2 col-form-label">
               {{ field.label_tag }}
            </div>
            <div class="col-md-10">
               <div class="input-group date" id="datetimepicker2" data-target-input="nearest">
                  <input name="{{ field.name }}" type="text" class="form-control datetimepicker-input" data-target="#datetimepicker2" id="to" required/>
                  <div class="input-group-append" data-target="#datetimepicker2" data-toggle="datetimepicker">
                     <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                  </div>
               </div>
            </div>
         </div>


         <!-- ======= CHAMP RADIO BUTTON ========= -->
         {% elif field.name == "status" %}
         <div class="form-group row">
            <div class="col-md-2 col-form-label">
               {{ field.label_tag }}
            </div>
            {% for radio in form.status %}
               <div class="col-md-2">
                   {{ radio }}
               </div>
            {% endfor %}
         </div>


         <!-- ======= CHAMP CATEGORY ========= -->
         {% elif field.name == "category" %}
         <div class="form-group row">
            <div class="col-md-2 col-form-label">
               {{ field.label_tag }}
            </div>
               <div class="col-md-2">
                  {{ field }}
                   <a href="JavaScript:Void(0);" onclick="toggle_visibility('input_field_cat');" id="toggle_plus"><i class="fa fa-plus"></i></a>
               </div>

               <!-- Si le user veut créer une nouvelle catégorie -->
               <div class="col-md-8" id="input_field_cat" style="display:none">
                      <input type="text" name="new_category" class="form-control" maxlength="200" id="id_new_category" placeholder="Nouvelle Catégorie">
               </div>
         </div>


         <!-- ======= AUTRE CHAMPS ========= -->
         {% else %}
            <div class="form-group row">
               <div class="col-md-2 col-form-label">
                  {{ field.label_tag }}
               </div>
               <div class="col-md-10">
                  {{ field }}
               </div>
            </div>



         {% endif %}
      {% endfor %}

      <!-- ========== SOUS TACHES ============== -->
      <div class="form-group row">
         <div class="col-md-2 col-form-label">
            Checklist :
         </div>
         <div class="col-md-5 pt-2" id="subtasks">
            <a href="JavaScript:Void(0);" onclick="create_subtask();" id="toggle_plus"><i class="fa fa-plus-square"></i></a>

         </div>
      </div>

		<br/>

      <input type="submit" value="Ajouter la tâche" />
   </form>
</div>

{% endblock %}
